{% extends "base.html" %}
{% load static %}

{% block title %}Perfil - {{ user_obj.username }}{% endblock %}

{% block extra_css %}<link rel="stylesheet" href="{% static 'css/account/detail.css' %}">{% endblock %}

{% block content %}
  <div class="page-container">
    <div class="panel" style="margin-top:2.5rem;">
      <div class="d-flex flex-column flex-md-row align-items-center gap-4">
        <!-- Avatar -->
        <div>
          <div class="avatar-wrap" style="width:120px; height:120px;">
            {% if person and person.avatar_url %}
              <img src="{{ person.avatar_url.url }}" alt="Avatar de {{ user_obj.username }}"
                  class="user-avatar-img avatar-img" style="width:120px; height:120px; object-fit:cover; border-radius:50%;">
            {% else %}
              <div class="user-avatar-default avatar-img" style="width:120px; height:120px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                {{ user_obj.username|first|upper }}
              </div>
            {% endif %}
            <a href="{% url 'account_edit_avatar' %}" class="avatar-overlay" title="Editar avatar" aria-label="Editar avatar">
              <button type="button" class="btn btn-sm avatar-edit-btn">
                <i class="fas fa-camera"></i> Editar
              </button>
            </a>
          </div>
        </div>

        <!-- Basic info -->
        <div class="flex-grow-1 w-100">
          <div class="d-flex align-items-start justify-content-between gap-3">
            <div>
              <div class="d-flex align-items-center gap-3">
                <h3 class="mb-0 text-muted">@{{ user_obj.username }}</h3>
              </div>

              <div class="mt-2 text-muted small">
                <i class="fas fa-envelope me-2"></i>{{ user_obj.email|default:"—" }}
                {% if person and person.location %}
                  &nbsp;·&nbsp; <i class="fas fa-map-marker-alt me-1"></i>{{ person.location }}
                {% endif %}
              </div>
            </div>

            <div class="text-end">
              {% if is_owner %}
                <a href="{% url 'account_edit_profile' %}" class="btn btn-sm btn-outline-primary me-2">Editar perfil</a>
                <a href="{% url 'account_delete_user' %}?mode=delete" class="btn btn-sm btn-outline-danger">Excluir conta</a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <hr style="margin:1.6rem 0; opacity:0.08; border-color:var(--soft)">

      <!-- Details grid -->
      <div class="row">
        <div class="col-md-4 mb-3">
          <h6 class="text-uppercase small text-primary">Nome</h6>
          <p class="mb-0">{{ person.name|default:'—' }}</p>
        </div>

        <div class="col-md-4 mb-3">
          <h6 class="text-uppercase small text-primary">Data de nascimento</h6>
          <p class="mb-0">
            {% if person and person.birthdate %}
              {{ person.birthdate|date:"d/m/Y" }}
            {% else %}
              —
            {% endif %}
          </p>
        </div>

        <div class="col-md-4 mb-3">
          <h6 class="text-uppercase small text-primary">Sexo</h6>
          <p class="mb-0">
            {% if person and person.gender %}
              {{ person.get_gender_display }}
            {% else %}
              —
            {% endif %}
          </p>
        </div>
      </div>

      <div class="mt-3">
        <h6 class="text-uppercase small text-primary">Biografia</h6>
        <p class="mb-0">{{ person.bio|default:"Sem biografia." }}</p>
      </div>

      <!-- Estatísticas -->
      <div class="mt-4">
        <div class="row g-3">
          <div class="col-sm-4">
            <div class="panel p-3 text-center">
              <div class="h4 mb-0">0</div>
              <div class="small text-muted">Reviews</div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="panel p-3 text-center">
              <div class="h4 mb-0">0</div>
              <div class="small text-muted">Listas</div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="panel p-3 text-center">
              <div class="h4 mb-0">0</div>
              <div class="small text-muted">Clubes</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status pills centralizados -->
      <div class="mt-4">
        <div class="statuses-row">
          <a href="{% url 'user_game_list' user_obj.id %}?status=P" class="status-pill">
            <span class="status-square status-p"></span>
            <span class="status-text">Para jogar ({{ status_counts.P|default:0 }})</span>
          </a>

          <a href="{% url 'user_game_list' user_obj.id %}?status=J" class="status-pill">
            <span class="status-square status-j"></span>
            <span class="status-text">Jogando ({{ status_counts.J|default:0 }})</span>
          </a>

          <a href="{% url 'user_game_list' user_obj.id %}?status=C" class="status-pill">
            <span class="status-square status-c"></span>
            <span class="status-text">Concluído ({{ status_counts.C|default:0 }})</span>
          </a>

          <a href="{% url 'user_game_list' user_obj.id %}?status=A" class="status-pill">
            <span class="status-square status-a"></span>
            <span class="status-text">Abandonado ({{ status_counts.A|default:0 }})</span>
          </a>
        </div>
      </div>

      <!-- Jogos favoritos -->
      <div class="favorites-section">
        <div class="favorites-header">
          <div>
            {% if is_owner %}
              <h5 class="text-accent">MEUS JOGOS FAVORITOS</h5>
            {% else %}
              <h5 class="text-accent">JOGOS FAVORITOS</h5>
            {% endif %}
          </div>
        
        </div>

        {% if favorite_games and favorite_games|length > 0 %}
          <div class="favorites-grid">
            {% for game in favorite_games %}
              <a href="{% url 'game_detail' game.id %}" class="game-card">
                {% if game.cover_url %}
                  <div class="game-thumb" style="background-image: url('{{ game.cover_url }}');"></div>
                {% else %}
                  <div class="game-thumb placeholder">
                    <i class="fas fa-gamepad"></i>
                  </div>
                {% endif %}
                <div class="game-info">
                  <div class="game-title">{{ game.title }}</div>
                  {% if game.genre %}
                    <div class="game-sub">{{ game.genre }}</div>
                  {% endif %}
                </div>
              </a>
            {% endfor %}
          </div>

        {% else %}
          <div class="favorites-empty">
            <div class="empty-icon">
              <i class="fas fa-gamepad"></i>
            </div>
            <div class="empty-text">
              <p class="mb-2">Você ainda não adicionou jogos favoritos.</p>
              <p class="small text-muted mb-0">Descubra novos jogos e adicione aos seus favoritos!</p>
            </div>
            <a href="{% url 'list_game' %}" class="btn btn-outline-primary">
              Explorar Jogos
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}