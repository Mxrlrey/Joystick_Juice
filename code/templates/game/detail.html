{% load static %}

<head>
    <meta charset="UTF-8">
    <title>{{ game.title }} — Joystick Juice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/game/detail.css' %}">
</head>

<body>

<div class="game-container">
    <!-- HERO BANNER -->
    <div class="hero-banner">
        {% if game.banner_url %}
        <div class="banner-img">
            <img src="{{ game.banner_url }}" alt="{{ game.title }} Banner">
        </div>
        {% endif %}

        <div class="hero-content">
            <!-- Cover -->
            <div class="cover-box">
                {% if game.cover_url %}
                <img src="{{ game.cover_url }}" alt="{{ game.title }} Cover">
                {% endif %}
            </div>

            <!-- Meta informações -->
            <div class="meta-box">
                <h1 class="game-title">{{ game.title }}</h1>
                <div class="submeta">
                    <span>{{ game.genre }}</span>
                    <span>•</span>
                    <span>{{ game.release_date }}</span>
                    <span>•</span>
                    <span>{{ game.developer|default:"Desconhecido" }}</span>
                </div>
                <p class="descricao">{{ game.synopsis }}</p>
                <div class="tag">
                    <span class="tags">{{ game.genre }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- LAYOUT DE DUAS COLUNAS -->
    <div class="content-layout">
        <!-- CAIXA DE AÇÕES (ESQUERDA) -->
        {% if user.is_authenticated %}
        <div class="actions-box">
            <div class="actions-header">
                <h3>SUA ATIVIDADE</h3>
            </div>

            <!-- Botões de Ação -->
            <div class="action-buttons">
                <!-- Favorito -->
                <form action="{% url 'toggle_favorite' game.id %}" method="post" class="w-100">
                    {% csrf_token %}
                    <button type="submit" class="action-btn favorite {% if is_favorite %}active{% endif %}">
                        <i class="fa-solid fa-heart"></i>
                        <span>{% if is_favorite %}Remover dos Favoritos{% else %}Adicionar aos Favoritos{% endif %}</span>
                    </button>
                </form>

                <!-- Curtida -->
                <form action="{% url 'toggle_like' game.id %}" method="post" class="w-100">
                    {% csrf_token %}
                    <button type="submit" class="action-btn like {% if is_liked %}active{% endif %}">
                        <i class="fa-solid fa-thumbs-up"></i>
                        <span>{% if is_liked %}Remover Curtida{% else %}Curtir Jogo{% endif %}</span>
                    </button>
                </form>

                <!-- Review (Botão Estático) -->
                <button class="action-btn review-btn" disabled>
                    <i class="fa-solid fa-star"></i>
                    <span>Fazer Review</span>
                </button>
            </div>

            <!-- LISTA -->
            {% if in_list %}
                <div class="status-section">
                    <div class="status-current">
                        Status atual:
                        <strong>
                            {% if user_status == "P" %}
                                Para jogar
                            {% elif user_status == "C" %}
                                Concluído
                            {% elif user_status == "J" %}
                                Jogando
                            {% elif user_status == "A" %}
                                Abandonado
                            {% else %}
                                ---
                            {% endif %}
                        </strong>
                    </div>

                    <form action="{% url 'update_game_status' game.id %}" method="post">
                        {% csrf_token %}
                        <div class="custom-dropdown">
                            <button type="button" class="dropdown-btn">
                                {% for code,label in status_form.fields.status.choices %}
                                    {% if code == user_status %}
                                        {{ label }}
                                    {% endif %}
                                {% endfor %}
                                <i class="fa-solid fa-chevron-down"></i>
                            </button>
                            <div class="dropdown-content">
                                {% for code,label in status_form.fields.status.choices %}
                                <div class="dropdown-item" data-value="{{ code }}">{{ label }}</div>
                                {% endfor %}
                            </div>
                        </div>
                        <input type="hidden" name="status" value="{{ user_status }}">
                        <button class="update-btn" type="submit">Atualizar Status</button>
                    </form>

                    <!-- Remover da lista -->
                    <div class="remove-section">
                        <form action="{% url 'remove_from_list' game.id %}" method="post">
                            {% csrf_token %}
                            <button class="btn-remove" type="submit">
                                <i class="fa-solid fa-trash"></i> Remover da Minha Lista
                            </button>
                        </form>
                    </div>
                </div>
            {% else %}
                <form action="{% url 'add_to_list' game.id %}" method="post">
                    {% csrf_token %}
                    <button class="update-btn" type="submit">
                        <i class="fa-solid fa-plus"></i> Adicionar à Minha Lista
                    </button>
                </form>
            {% endif %}
        </div>
        {% endif %}

        <!-- TRAILER (DIREITA) -->
        {% if game.trailer_url %}
        <div class="trailer-container">
            <div class="ratio ratio-16x9">
                <iframe
                    src="{{ game.trailer_url }}"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    referrerpolicy="strict-origin-when-cross-origin"
                    title="Trailer do jogo">
                </iframe>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script src="{% static 'js/game/detail.js' %}"></script>

</body>